<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Painel de Licen√ßas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap 5 via CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background:#0f172a; color:#e2e8f0; }
    .navbar { background:#111827; }
    .card { background:#111827; border:1px solid #1f2937; }
    .table { --bs-table-bg: transparent; color:#e5e7eb; }
    .table thead th { color:#9ca3af; }
    .badge-soft { background:#1f2937; color:#93c5fd; }
    a, a:hover { color:#93c5fd; }
    .mono { font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace; }
  </style>
</head>
<body>
<nav class="navbar navbar-dark">
  <div class="container-fluid">
    <span class="navbar-brand">üîê Painel de Licen√ßas</span>
    <span class="text-secondary">Admin conectado</span>
  </div>
</nav>

<div class="container py-4">
  <!-- Stats -->
  <div class="row g-3">
    <div class="col-6 col-md-3">
      <div class="card p-3">
        <div class="text-secondary small">Licen√ßas</div>
        <div class="fs-3 fw-semibold">{{ stats.total }}</div>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="card p-3">
        <div class="text-secondary small">V√°lidas</div>
        <div class="fs-3 fw-semibold text-success">{{ stats.valid }}</div>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="card p-3">
        <div class="text-secondary small">Revogadas</div>
        <div class="fs-3 fw-semibold text-danger">{{ stats.revoked }}</div>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="card p-3">
        <div class="text-secondary small">Ativa√ß√µes</div>
        <div class="fs-3 fw-semibold">{{ stats.activations }}</div>
      </div>
    </div>
  </div>

  <!-- Create -->
  <div class="card mt-4">
    <div class="card-body">
      <h5 class="card-title mb-3">Criar nova licen√ßa</h5>
      <form class="row g-2" method="post" action="/admin/create?token={{ token }}">
        <div class="col-sm-7">
          <input name="hwid" class="form-control" placeholder="HWID do cliente" required>
        </div>
        <div class="col-sm-2">
          <input name="days" class="form-control" value="30" type="number" min="1">
        </div>
        <div class="col-sm-3">
          <button class="btn btn-primary w-100" type="submit">Criar</button>
        </div>
      </form>
      <div class="small mt-2 text-secondary">Dica: pe√ßa o HWID que aparece no cliente.</div>
    </div>
  </div>

  <!-- Licenses table -->
  <div class="card mt-4">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h5 class="card-title mb-0">Licen√ßas recentes</h5>
        <span class="badge rounded-pill badge-soft">m√°x. 200</span>
      </div>
      <div class="table-responsive">
        <table class="table table-sm align-middle">
          <thead>
            <tr>
              <th>ID</th>
              <th>License</th>
              <th>HWID</th>
              <th>Validade</th>
              <th>Status</th>
              <th class="text-end">A√ß√µes</th>
            </tr>
          </thead>
          <tbody>
            {% for r in licenses %}
            <tr>
              <td>{{ r.id }}</td>
              <td class="mono">
                <span class="copy" data-copy="{{ r.license_key }}">{{ r.license_key[:10] }}‚Ä¶</span>
              </td>
              <td class="mono">{{ r.hwid[:20] }}‚Ä¶</td>
              <td>{{ r.valid_until }}</td>
              <td>
                {% if r.revoked == 1 %}
                  <span class="badge bg-danger">revogada</span>
                {% elif r.valid_until < (namespace.now if namespace.now else '') %}
                  <span class="badge bg-warning text-dark">expirada</span>
                {% else %}
                  <span class="badge bg-success">v√°lida</span>
                {% endif %}
              </td>
              <td class="text-end">
                {% if r.revoked == 0 %}
                <form class="d-inline" method="post" action="/admin/revoke?token={{ token }}" onsubmit="return confirm('Revogar esta licen√ßa?');">
                  <input type="hidden" name="license_key" value="{{ r.license_key }}">
                  <button class="btn btn-outline-danger btn-sm">Revogar</button>
                </form>
                {% else %}
                  <button class="btn btn-outline-secondary btn-sm" disabled>Revogada</button>
                {% endif %}
                <button class="btn btn-outline-light btn-sm ms-2" onclick="copyText('{{ r.license_key }}')">Copiar</button>
              </td>
            </tr>
            {% endfor %}
            {% if licenses|length == 0 %}
            <tr><td colspan="6" class="text-center text-secondary">Sem licen√ßas ainda.</td></tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Activations -->
  <div class="card mt-4">
    <div class="card-body">
      <h5 class="card-title">√öltimas ativa√ß√µes</h5>
      <div class="table-responsive">
        <table class="table table-sm">
          <thead><tr><th>ID</th><th>License</th><th>HWID</th><th>IP</th><th>Data</th></tr></thead>
          <tbody>
            {% for a in activations %}
              <tr>
                <td>{{ a.id }}</td>
                <td class="mono">{{ a.license_key[:10] }}‚Ä¶</td>
                <td class="mono">{{ a.hwid[:20] }}‚Ä¶</td>
                <td>{{ a.ip }}</td>
                <td>{{ a.ts }}</td>
              </tr>
            {% endfor %}
            {% if activations|length == 0 %}
            <tr><td colspan="5" class="text-center text-secondary">Nenhuma ativa√ß√£o ainda.</td></tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <footer class="text-secondary small mt-4">Token em uso: <span class="mono">{{ token }}</span></footer>
</div>

<script>
function copyText(t){
  navigator.clipboard.writeText(t);
}
</script>
</body>
</html>
