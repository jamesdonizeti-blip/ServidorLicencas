<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel Admin - Licenças</title>

    <!-- BOOTSTRAP -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body { background: #f4f6f9; }
        .card { border-radius: 12px; }
        .table td, .table th { vertical-align: middle; }
        code { font-size: 13px; }
    </style>
</head>

<body class="p-4">

<div class="container">
    <h2 class="mb-3">Painel Administrativo</h2>
    <p class="text-muted">Conectado como administrador</p>

    <!-- ======================= -->
    <!-- CARDS DE ESTATÍSTICAS -->
    <!-- ======================= -->
    <div class="row g-3 mb-4">

        <div class="col-md-3">
            <div class="card shadow-sm p-3">
                <h5>Total Licenças</h5>
                <h3 class="text-primary">{{ stats.total }}</h3>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow-sm p-3">
                <h5>Ativas</h5>
                <h3 class="text-success">{{ stats.valid }}</h3>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow-sm p-3">
                <h5>Revogadas</h5>
                <h3 class="text-danger">{{ stats.revoked }}</h3>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow-sm p-3">
                <h5>Ativações</h5>
                <h3 class="text-info">{{ stats.activations }}</h3>
            </div>
        </div>

    </div>

    <!-- ======================= -->
    <!-- CRIAÇÃO DE LICENÇA -->
    <!-- ======================= -->
    <div class="card shadow-sm p-4 mb-4">
        <h4>Criar nova licença</h4>
        <form class="row g-3 mt-2" method="post" action="/admin/create?token={{ token }}">
            <div class="col-md-6">
                <label class="form-label">HWID</label>
                <input name="hwid" class="form-control" required>
            </div>

            <div class="col-md-2">
                <label class="form-label">Dias</label>
                <input name="days" type="number" value="30" class="form-control">
            </div>

            <div class="col-md-3 d-flex align-items-end">
                <button class="btn btn-primary w-100">Criar</button>
            </div>
        </form>
    </div>

    <!-- ======================= -->
    <!-- TABELA DE LICENÇAS -->
    <!-- ======================= -->
    <div class="card shadow-sm p-4 mb-4">
        <h4>Licenças Registradas</h4>

        <div class="table-responsive mt-3">
            <table class="table table-bordered table-striped">
                <thead class="table-light">
                <tr>
                    <th>ID</th>
                    <th>Licença</th>
                    <th>HWID</th>
                    <th>Validade</th>
                    <th>Status</th>
                    <th>Ações</th>
                </tr>
                </thead>

                <tbody>
                {% for r in licenses %}
                <tr>
                    <td>{{ r.id }}</td>
                    <td><code>{{ r.license_key }}</code></td>
                    <td>{{ r.hwid }}</td>
                    <td>{{ r.valid_until }}</td>

                    <td>
                        {% if r.revoked == 1 %}
                            <span class="badge bg-danger">Revogada</span>
                        {% else %}
                            <span class="badge bg-success">Ativa</span>
                        {% endif %}
                    </td>

                    <td>
                        {% if r.revoked == 0 %}
                        <form method="post" action="/admin/revoke?token={{ token }}">
                            <input type="hidden" name="license_key" value="{{ r.license_key }}">
                            <button class="btn btn-sm btn-danger">Revogar</button>
                        </form>
                        {% else %}
                        —
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- ======================= -->
    <!-- ATIVAÇÕES RECENTES -->
    <!-- ======================= -->
    <div class="card shadow-sm p-4">
        <h4>Últimas ativações</h4>

        <div class="table-responsive mt-3">
            <table class="table table-bordered table-striped">
                <thead class="table-light">
                <tr>
                    <th>ID</th>
                    <th>Licença</th>
                    <th>HWID</th>
                    <th>IP</th>
                    <th>Quando</th>
                </tr>
                </thead>

                <tbody>
                {% for a in activations %}
                <tr>
                    <td>{{ a.id }}</td>
                    <td><code>{{ a.license_key }}</code></td>
                    <td>{{ a.hwid }}</td>
                    <td>{{ a.ip }}</td>
                    <td>{{ a.ts }}</td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

    </div>

</div>

</body>
</html>
